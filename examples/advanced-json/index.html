<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>FormFx v0.3 - JSON Rules Example</title>
  <style>
    body { font-family: sans-serif; padding: 20px; line-height: 1.6; background: #f4f7f6; }
    .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h1 { margin-top: 0; color: #333; }
    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 5px; font-weight: bold; }
    input[type="text"], input[type="number"], select { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
    .help { font-size: 0.85em; color: #666; margin-top: 4px; }
    .injury-block { background: #fff5f5; padding: 15px; border-left: 4px solid #ff4d4f; margin-top: 10px; }
    button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #0056b3; }
    button.secondary { background: #6c757d; }
    .controls { margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee; }
  </style>
</head>
<body>

<div class="container">
  <h1>FormFx v0.3 Demo</h1>
  <p>JSON Rules & Debug Panel</p>

  <form id="demo-form">
    <div class="form-group">
      <label>怪我をしていますか？</label>
      <select id="hasInjury">
        <option value="false">いいえ</option>
        <option value="true">はい</option>
      </select>
    </div>

    <div id="injuryBlock" class="form-group injury-block">
      <label for="injuryDetail">怪我の詳細（必須になります）</label>
      <input type="text" id="injuryDetail" placeholder="足の捻挫など">
    </div>

    <div class="form-group">
      <label>お名前</label>
      <input type="text" id="userName" data-fx-required="true">
    </div>

    <div class="form-group">
      <label>年齢</label>
      <input type="number" id="userAge" value="20">
      <p id="ageWarning" data-fx-show="#userAge < 18" style="color: red; font-size: 0.8em;">18歳未満の方は保護者の同意が必要です。</p>
    </div>

    <button type="submit">送信</button>
  </form>

  <div class="controls">
    <button class="secondary" onclick="toggleInjuryRule()">怪我ルールの有効/無効切替</button>
  </div>
</div>

<!-- 開発時はビルド済みのJSを読み込む想定（ここでは便宜上CDNや相対パスをイメージ） -->
<script type="module">
  import { FormFx } from '../../dist/index.js';

  // JSONルールの定義
  const rules = [
    {
      id: "injury-rule",
      if: "#hasInjury == 'true'",
      then: [
        { show: "#injuryBlock" },
        { require: "#injuryDetail" }
      ],
      else: [
        { hide: "#injuryBlock" }
      ]
    }
  ];

  const fx = new FormFx(document.getElementById('demo-form'), {
    rules: rules,
    debug: true
  });
  fx.mount();

  // グローバル関数として公開（HTML内のonclickから呼ぶため）
  let injuryRuleEnabled = true;
  window.toggleInjuryRule = function() {
    if (injuryRuleEnabled) {
      fx.disableRule("injury-rule");
      injuryRuleEnabled = false;
      console.log("Injury rule disabled");
    } else {
      fx.enableRule("injury-rule");
      injuryRuleEnabled = true;
      console.log("Injury rule enabled");
    }
  }
</script>

</body>
</html>
