<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FormFx v0.2 Advanced Example</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 2rem auto; line-height: 1.6; background-color: #f4f7f6; }
        .card { background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: bold; color: #333; }
        input[type="text"], input[type="number"], select, textarea { 
            width: 100%; padding: 0.6rem; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;
        }
        .repeater-item { 
            border: 1px solid #ddd; padding: 1rem; margin-bottom: 1rem; border-radius: 4px; background: #fafafa;
            border-left: 5px solid #4a90e2; position: relative;
        }
        .remove-btn { color: #e74c3c; cursor: pointer; font-size: 0.9rem; float: right; }
        .hint { font-size: 0.85rem; color: #666; margin-top: 0.3rem; }
        .required-mark { color: #e74c3c; margin-left: 4px; }
        .hidden { display: none; }
        .debug-panel { margin-top: 2rem; padding: 1rem; background: #333; color: #fff; border-radius: 4px; font-family: monospace; }
        button { 
            padding: 0.7rem 1.2rem; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer;
        }
        button:hover { background: #357abd; }
        .btn-add { background: #2ecc71; margin-bottom: 1rem; }
        .btn-add:hover { background: #27ae60; }
    </style>
</head>
<body>
    <div class="card">
        <h1>FormFx v0.2 新機能デモ</h1>
        <p>数値比較、in関数、リピーター行内スコープ、clear/enable効果のデモです。</p>

        <form id="advanced-form">
            <!-- 1) 数値比較と enable -->
            <div class="form-group">
                <label for="count">注文数 (3個以上で割引コード入力可)</label>
                <input type="number" id="count" value="1" min="0">
            </div>

            <div class="form-group">
                <label for="discount">割引コード</label>
                <input type="text" id="discount" data-fx-enable="#count >= 3" placeholder="#count >= 3 のとき入力可能">
                <p class="hint" data-fx-show="#count < 3">3個以上注文すると入力できるようになります。</p>
            </div>

            <hr>

            <!-- 2) in 関数と clear -->
            <div class="form-group">
                <label for="category">カテゴリー</label>
                <select id="category">
                    <option value="none">選択なし</option>
                    <option value="food">食品</option>
                    <option value="drink">飲料</option>
                    <option value="other">その他</option>
                </select>
            </div>

            <div class="form-group" data-fx-show="in(#category, ['food', 'drink'])">
                <label for="temp">保存温度設定</label>
                <select id="temp" data-fx-clear="#category == 'other'">
                    <option value="normal">常温</option>
                    <option value="cold">冷蔵</option>
                    <option value="frozen">冷凍</option>
                </select>
                <p class="hint">食品・飲料の場合のみ表示。カテゴリーが「その他」になると値がクリアされます。</p>
            </div>

            <hr>

            <!-- 3) Repeater 行内スコープ -->
            <div class="form-group" data-fx-repeater data-fx-name="items" data-fx-max="5">
                <label>明細項目</label>
                <button type="button" class="btn-add" data-fx-add>項目を追加</button>
                
                <div data-fx-list>
                    <!-- ここに行が追加される -->
                </div>

                <template data-fx-template>
                    <div class="repeater-item" data-fx-item>
                        <span class="remove-btn" data-fx-remove>✖ 削除</span>
                        
                        <div class="form-group" data-fx-field="type">
                            <label>種別</label>
                            <select>
                                <option value="standard">標準</option>
                                <option value="option">オプション</option>
                                <option value="gift">ギフト</option>
                            </select>
                        </div>

                        <div class="form-group" data-fx-field="note" data-fx-show="@row.type == 'gift'">
                            <label>ギフトメッセージ <span class="required-mark">*</span></label>
                            <textarea data-fx-required="@row.type == 'gift'" placeholder="メッセージを入力してください"></textarea>
                            <p class="hint">種別が「ギフト」の時のみ表示・必須になります。</p>
                        </div>

                        <div class="form-group" data-fx-field="price">
                            <label>単価</label>
                            <input type="number" value="0">
                        </div>

                        <p class="hint" data-fx-show="@row.price > 1000" style="color: #e67e22;">
                            高額商品です！ (単価 > 1000)
                        </p>
                    </div>
                </template>
            </div>

            <div style="margin-top: 2rem;">
                <button type="submit">送信してコンソールを確認</button>
            </div>
        </form>
    </div>

    <script type="module">
        import { FormFx } from '../../dist/index.js'; // tsup等での開発中を想定

        const form = document.getElementById('advanced-form');
        const fx = new FormFx(form, {
            debug: true,
            clearOnHide: true
        });
        fx.mount();

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });
            console.log('Submitted Data:', data);
            alert('送信されました。コンソールを確認してください。');
        });
    </script>
</body>
</html>
